<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Add Seats</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
	font-family: "Poppins", sans-serif;
	background: #f8f9fa;
	padding-top: 80px;
}

.container-box {
	max-width: 1000px;
	margin: auto;
	background: #fff;
	padding: 30px;
	border-radius: 12px;
	box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}

.row-box {
	border: 1px solid #eee;
	padding: 20px;
	border-radius: 10px;
	margin-bottom: 25px;
}

.seat-box {
	position: relative;
}

.seat-input {
	width: 70px;
	text-align: center;
	font-weight: 600;
}

.remove-seat {
	position: absolute;
	top: -8px;
	right: -8px;
	background: #dc3545;
	color: #fff;
	border-radius: 50%;
	width: 20px;
	height: 20px;
	font-size: 12px;
	line-height: 18px;
	text-align: center;
	cursor: pointer;
}
</style>
</head>
<body>

<div class="container-box">
	<h2 class="mb-4">➕ Add Seats</h2>

	<form th:action="@{'/add-seats/' + ${id}}" method="post">

		<div id="rowsContainer"></div>

		<div class="mt-3">
			<button type="button" class="btn btn-secondary" onclick="addRow()">+ Add Row</button>
			<button type="submit" class="btn btn-success">Save Seats</button>
		</div>
	</form>
</div>

<script>
let rowIndex = 0;

/* ================= PAGE LOAD ================= */
window.onload = function () {
	addRow(); // ALWAYS start with one row
};

/* ================= ADD ROW ================= */
function addRow() {
	const container = document.getElementById("rowsContainer");

	container.insertAdjacentHTML("beforeend", `
		<div class="row-box" data-row="${rowIndex}">
			
			<div class="row mb-3">
				<div class="col-md-4">
					<input name="rows[${rowIndex}].rowName"
						   class="form-control"
						   placeholder="Row Name (A, B, VIP)"
						   required>
				</div>

				<div class="col-md-4">
					<select name="rows[${rowIndex}].category" class="form-select">
						<option value="REGULAR">REGULAR</option>
						<option value="PREMIUM">PREMIUM</option>
						<option value="VIP">VIP</option>
					</select>
				</div>

				<div class="col-md-4 text-end">
					<button type="button"
					        class="btn btn-sm btn-outline-danger"
					        onclick="removeRow(${rowIndex})">
						Remove Row
					</button>
				</div>
			</div>

			<div class="d-flex gap-3 flex-wrap mb-3" id="cols-${rowIndex}"></div>

			<button type="button"
			        class="btn btn-sm btn-outline-primary"
			        onclick="addSeat(${rowIndex})">
				+ Add Column
			</button>
		</div>
	`);

	addSeat(rowIndex); // first seat
	rowIndex++;
}

/* ================= ADD COLUMN ================= */
function addSeat(r) {
	const colDiv = document.getElementById(`cols-${r}`);
	if (!colDiv) return;

	const idx = colDiv.children.length;

	colDiv.insertAdjacentHTML("beforeend", `
		<div class="seat-box">
			<input name="rows[${r}].columns[${idx}].name"
			       class="form-control seat-input"
			       placeholder="1"
			       required>
			<span class="remove-seat" onclick="removeSeat(this)">×</span>
		</div>
	`);
}

/* ================= REMOVE COLUMN ================= */
function removeSeat(el) {
	const colDiv = el.parentElement.parentElement;
	el.parentElement.remove();
	reindexColumns(colDiv);
}

/* ================= REINDEX COLUMNS ================= */
function reindexColumns(colDiv) {
	const inputs = colDiv.querySelectorAll("input");
	inputs.forEach((input, index) => {
		input.name = input.name.replace(/columns\[\d+\]/, `columns[${index}]`);
	});
}

/* ================= REMOVE ROW ================= */
function removeRow(r) {
	const row = document.querySelector(`[data-row="${r}"]`);
	if (row) row.remove();
}
</script>

</body>
</html>
